    /* ============================================================
     * MONTH VIEW
     * ============================================================
     *
     * This method renders the classic month grid view.
     *
     * ────────────────────────────────────────────────────────────
     * CONTEXT / PRECONDITIONS
     * ────────────────────────────────────────────────────────────
     *
     * At the time this method is called, the following is already true:
     *
     * 1. The CalendarView instance exists and is fully initialized.
     *
     * 2. Global calendar state is valid:
     *    - this.displayedYear   → year currently shown
     *    - this.displayedMonth  → month currently shown (0–11)
     *    - this.selectedDay    → null or a specific day number
     *
     * 3. Navigation has already been rendered via renderNav().
     *
     * 4. this.contentBox is empty and ready to receive new UI elements.
     *
     * 5. The EventManager is active and provides:
     *    - hasEvents(date)
     *    - getEventsForDate(date)
     *
     * 6. Optional helpers may be available:
     *    - CalendarLogic (for holidays)
     *    - Tooltips.Tooltip (for hover details)
     *
     * This method does NOT persist state.
     * It only reads state and builds UI accordingly.
     *
     * ────────────────────────────────────────────────────────────
     * DESIGN OVERVIEW
     * ────────────────────────────────────────────────────────────
     *
     * The month view consists of:
     *
     * - A 7-column grid (Monday → Sunday)
     * - Optional week-number column on the left
     * - Always 6 rows (maximum weeks a month can span)
     *
     * Each cell:
     * - Represents a single calendar day
     * - Is clickable
     * - Can show:
     *   • day number
     *   • event indicator dot
     *   • holiday styling
     *   • tooltip with details
     *
     * TODO (Architectural):
     * If CalendarView is ever split into multiple files,
     * this method would need:
     * - Access to shared state (displayedYear, displayedMonth, selectedDay)
     * - Access to EventManager and CalendarLogic
     * Therefore it currently must remain a method of this class.
     */

    private renderMonthView(): void {
        /* --------------------------------------------------------
         * GRID INITIALIZATION
         * --------------------------------------------------------
         *
         * St.Table is used instead of BoxLayout because:
         * - We need a strict row/column layout
         * - All cells should have equal size
         */

        const grid = new St.Table({
            homogeneous: true,
            style_class: "calendar",
        });

        /* --------------------------------------------------------
         * WEEK NUMBER COLUMN OFFSET
         * --------------------------------------------------------
         *
         * If week numbers are enabled, column 0 is reserved
         * for them and all weekday columns shift by +1.
         */

        const colOffset = this.applet.showWeekNumbers ? 1 : 0;

        /* --------------------------------------------------------
         * WEEKDAY HEADER ROW
         * --------------------------------------------------------
         *
         * Adds localized weekday names (Mon–Sun) as the first row.
         */

        this.getDayNames().forEach((name, i) => {
            grid.add(
                new St.Label({
                    text: name,
                    style_class: "calendar-day-base",
                }),
                { row: 0, col: i + colOffset }
            );
        });

        /* --------------------------------------------------------
         * DATE ITERATION SETUP
         * --------------------------------------------------------
         *
         * We start at the first visible cell of the grid,
         * which may belong to the previous month.
         *
         * The calendar uses Monday as the first weekday.
         */

        let iter = new Date(this.displayedYear, this.displayedMonth, 1);

        // Convert JS Sunday-based index to Monday-based index
        const firstWeekday = (iter.getDay() + 6) % 7;

        // Move iterator back to the Monday of the first visible week
        iter.setDate(iter.getDate() - firstWeekday);

        /* --------------------------------------------------------
         * NORMALIZED "TODAY" DATE
         * --------------------------------------------------------
         *
         * Used for visual highlighting of the current day.
         */

        const today = new Date();
        today.setHours(0, 0, 0, 0);

        /* --------------------------------------------------------
         * MAIN GRID LOOP (6 WEEKS × 7 DAYS)
         * --------------------------------------------------------
         *
         * We always render 6 rows to keep layout stable,
         * even for short months.
         */

        for (let row = 1; row <= 6; row++) {

            /* ----------------------------------------------------
             * WEEK NUMBER COLUMN (OPTIONAL)
             * ----------------------------------------------------
             *
             * ISO week number calculation:
             * - Thursday determines the week number
             */

            if (this.applet.showWeekNumbers) {
                const kwDate = new Date(iter);
                kwDate.setDate(kwDate.getDate() + 3);

                grid.add(
                    new St.Label({
                        text: this.getWeekNumber(kwDate).toString(),
                        style_class: "calendar-week-number",
                    }),
                    { row, col: 0 }
                );
            }

            /* ----------------------------------------------------
             * DAY CELLS (MONDAY → SUNDAY)
             * ----------------------------------------------------
             */

            for (let col = 0; col < 7; col++) {
                const isOtherMonth =
                    iter.getMonth() !== this.displayedMonth;

                const isToday =
                    iter.getTime() === today.getTime();

                const hasEvents =
                    !isOtherMonth &&
                    this.applet.eventManager.hasEvents(iter);

                /* --------------------------------------------
                 * HOLIDAY HANDLING (OPTIONAL)
                 * --------------------------------------------
                 */

                const holidays =
                    !isOtherMonth && this.applet.CalendarLogic
                        ? this.applet.CalendarLogic.getHolidaysForDate(
                              iter,
                              "de"
                          )
                        : [];

                const isHoliday = holidays.length > 0;

                /* --------------------------------------------
                 * CSS CLASS COMPOSITION
                 * --------------------------------------------
                 *
                 * Styling is entirely CSS-driven.
                 * Logic here only decides which classes apply.
                 */

                const btnClasses = ["calendar-day"];

                if (isOtherMonth)
                    btnClasses.push("calendar-other-month-day");

                if (isToday)
                    btnClasses.push("calendar-today");

                if (iter.getDay() === 0 || isHoliday)
                    btnClasses.push("calendar-nonwork-day");

                /* --------------------------------------------
                 * DAY BUTTON
                 * --------------------------------------------
                 *
                 * Each day is a button so it can:
                 * - Receive focus
                 * - Be clicked
                 * - Host a tooltip
                 */

                const btn = new St.Button({
                    reactive: true,
                    can_focus: true,
                    style_class: btnClasses.join(" "),
                });

                /* --------------------------------------------
                 * DAY CELL CONTENT
                 * --------------------------------------------
                 *
                 * Vertical layout:
                 * - Day number
                 * - Event indicator dot
                 */

                const content = new St.BoxLayout({
                    vertical: true,
                    x_align: St.Align.MIDDLE,
                });

                content.add_actor(
                    new St.Label({
                        text: iter.getDate().toString(),
                        style_class: "calendar-day-label",
                    })
                );

                content.add_actor(
                    new St.Label({
                        text: hasEvents ? "•" : " ",
                        style_class: "calendar-day-event-dot-label",
                    })
                );

                btn.set_child(content);

                /* --------------------------------------------
                 * TOOLTIP (OPTIONAL)
                 * --------------------------------------------
                 *
                 * Shows holidays and event summaries on hover.
                 */

                if (Tooltips.Tooltip) {
                    const tooltipLines: string[] = [];

                    holidays.forEach(h => tooltipLines.push(h));

                    if (hasEvents) {
                        const events =
                            this.applet.eventManager.getEventsForDate(
                                iter
                            );
                        events.forEach((e: any) =>
                            tooltipLines.push(`• ${e.summary}`)
                        );
                    }

                    if (tooltipLines.length > 0) {
                        new Tooltips.Tooltip(
                            btn,
                            tooltipLines.join("\n")
                        );
                    }
                }

                /* --------------------------------------------
                 * CLICK HANDLER
                 * --------------------------------------------
                 *
                 * Clicking a day:
                 * - Updates global calendar state
                 * - Switches to DAY view
                 * - Triggers full re-render
                 */

                const d = iter.getDate();
                const m = iter.getMonth();
                const y = iter.getFullYear();

                btn.connect("clicked", () => {
                    this.selectedDay = d;
                    this.displayedMonth = m;
                    this.displayedYear = y;
                    this.currentView = "DAY";
                    this.render();
                });

                /* --------------------------------------------
                 * ADD CELL TO GRID
                 * --------------------------------------------
                 */

                grid.add(btn, {
                    row,
                    col: col + colOffset,
                });

                // Advance iterator to next day
                iter.setDate(iter.getDate() + 1);
            }
        }

        /* --------------------------------------------------------
         * FINALIZE VIEW
         * --------------------------------------------------------
         *
         * Add the fully constructed grid to the content area.
         */

        this.contentBox.add_actor(grid);
    }

