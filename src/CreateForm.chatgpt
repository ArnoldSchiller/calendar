    /* ============================================================
     * CREATE / EDIT FORM
     * ============================================================
     *
     * This method builds the inline form used to:
     * - Create a new calendar event
     * - Edit an existing calendar event
     *
     * IMPORTANT CONTEXT (How we get here):
     *
     * - This form is ONLY rendered from renderDayView()
     * - It is injected into the Day View depending on `dayMode`
     *   ("ADD" or "EDIT")
     * - The surrounding popup is NOT a dialog but part of the
     *   Cinnamon applet popup UI
     *
     * WHY THIS IS INLINE (and not a dialog):
     *
     * - Cinnamon applets have limited dialog APIs
     * - Keeping everything inside the popup avoids focus issues
     * - Rendering inline allows full reuse of CalendarView state
     *
     * TODO (Architectural Improvement):
     * - Extract this form into a dedicated component or dialog
     * - Decouple UI logic from CalendarView
     * - Allow asynchronous validation / error feedback
     */

    private createTerminForm(date: Date, editingEvent?: any): any {

        /* --------------------------------------------------------
         * ROOT CONTAINER
         * --------------------------------------------------------
         *
         * Vertical layout that contains:
         * - All-day toggle
         * - Title input
         * - Time inputs
         * - (Optional) description input (currently disabled)
         * - Save button
         */

        const box = new St.BoxLayout({
            vertical: true,
            style_class: "calendar-main-box",
            x_expand: true
        });

        /* --------------------------------------------------------
         * EVENT ID HANDLING
         * --------------------------------------------------------
         *
         * - If editing an existing event:
         *   → reuse its UUID
         * - If creating a new event:
         *   → do NOT generate a UUID here
         *
         * WHY NOT GENERATE UUID HERE?
         *
         * - EDS (Evolution Data Server) is able to generate IDs
         * - Manual UUID handling is error-prone with EDS sources
         * - Let EventManager / backend decide when necessary
         */

        const currentId = editingEvent ? editingEvent.id : undefined;

        /* --------------------------------------------------------
         * ALL-DAY TOGGLE
         * --------------------------------------------------------
         *
         * This replaces a traditional checkbox.
         *
         * Reason:
         * - St does not have a native checkbox widget
         * - Button with toggle_mode is more consistent visually
         *
         * Behavior:
         * - When enabled:
         *   → Time fields become visually disabled
         *   → Time fields are non-interactive
         */

        const isInitialFullDay = editingEvent ? editingEvent.isFullDay : false;
        const allDayCheckbox = new St.Button({
            label: isInitialFullDay ? "☑ " + _("All Day") : "☐ " + _("All Day"),
            style_class: "calendar-event-button",
            toggle_mode: true,
            checked: isInitialFullDay,
            x_align: St.Align.START
        });

        /* --------------------------------------------------------
         * TITLE / SUMMARY ENTRY
         * --------------------------------------------------------
         *
         * This maps directly to the VEVENT SUMMARY field.
         * It is the ONLY required field for saving.
         */

        const titleEntry = new St.Entry({
            hint_text: _("What? (Nice event)"),
            style_class: "calendar-event-summary",
            text: editingEvent ? editingEvent.summary : ""
        });

        /* --------------------------------------------------------
         * TIME HANDLING
         * --------------------------------------------------------
         *
         * Time values are handled as strings (HH:MM) in the UI.
         * Conversion to Date objects happens only on Save.
         */

        const formatTime = (d: Date) => {
            return `${String(d.getHours()).padStart(2, "0")}:${String(d.getMinutes()).padStart(2, "0")}`;
        };

        const startTimeStr = editingEvent
            ? formatTime(editingEvent.start)
            : this._getCurrentTime();

        const endTimeStr = editingEvent
            ? formatTime(editingEvent.end)
            : this._calculateDefaultEnd(startTimeStr);

        const descriptionStr =
            (editingEvent && typeof editingEvent.description === 'string')
                ? editingEvent.description
                : "";

        const timeBox = new St.BoxLayout({
            vertical: false,
            style: "margin: 5px 0;"
        });

        const startEntry = new St.Entry({
            text: startTimeStr,
            style_class: "calendar-event-time-present",
            can_focus: true,
            reactive: true
        });

        const endEntry = new St.Entry({
            text: endTimeStr,
            style_class: "calendar-event-time-present",
            can_focus: true,
            reactive: true
        });

        /* --------------------------------------------------------
         * TIME FIELD VISIBILITY / ENABLE LOGIC
         * --------------------------------------------------------
         *
         * Centralized logic to enable / disable time fields
         * depending on the All-Day toggle.
         *
         * Visual feedback:
         * - Reduced opacity when disabled
         * - Input and focus disabled
         */

        const updateVisibility = () => {
            const isFullDay = allDayCheckbox.checked;

            allDayCheckbox.set_label(
                isFullDay ? "☑ " + _("All Day") : "☐ " + _("All Day")
            );
            
            const opacity = isFullDay ? 128 : 255;
            startEntry.set_opacity(opacity);
            endEntry.set_opacity(opacity);
            startEntry.set_reactive(!isFullDay);
            endEntry.set_reactive(!isFullDay);
            startEntry.can_focus = !isFullDay;
            endEntry.can_focus = !isFullDay;
        };

        allDayCheckbox.connect("clicked", () => {
            updateVisibility();
        });

        timeBox.add_actor(new St.Label({
            text: _("From:"),
            style: "margin-right: 5px;"
        }));
        timeBox.add_actor(startEntry);
        timeBox.add_actor(new St.Label({
            text: _("To:"),
            style: "margin: 0 5px;"
        }));
        timeBox.add_actor(endEntry);

        /* --------------------------------------------------------
         * DESCRIPTION FIELD (DISABLED / COMMENTED OUT)
         * --------------------------------------------------------
         *
         * WHY THIS IS DISABLED:
         *
         * - Cinnamon CalendarServer + GJS/GIR has known issues
         *   with VEVENT DESCRIPTION handling
         * - set_description / set_description_list behave
         *   inconsistently across environments
         * - Description data may be silently dropped or break
         *   CREATE operations
         *
         * CURRENT DECISION:
         * - Keep the UI code commented for future reference
         * - Do NOT expose broken functionality to users
         *
         * TODO:
         * - Re-enable when EDS + CalendarServer reliably
         *   supports description roundtrips
         */

        /*
        const descEntry = new St.Entry({
            hint_text: _("Description"),
            style_class: "calendar-event-row-content", 
            x_expand: true,
            text: descriptionStr
        });
        */

        /*
        descEntry.clutter_text.single_line_mode = false;
        descEntry.clutter_text.line_wrap = true;
        descEntry.clutter_text.set_activatable(false);
        */

        /* --------------------------------------------------------
         * SAVE BUTTON
         * --------------------------------------------------------
         *
         * On click:
         * - Validate title
         * - Build Date objects
         * - Delegate persistence to EventManager
         *
         * IMPORTANT UX NOTE:
         *
         * After Save:
         * - The form closes immediately
         * - The popup re-renders
         *
         * This feels abrupt for users.
         *
         * TODO (UX Improvement):
         * - Keep form open until backend confirms success
         * - Show error feedback on failure
         */

        const buttonBox = new St.BoxLayout({
            style: "margin-top: 10px;"
        });

        const saveBtn = new St.Button({
            label: editingEvent ? _("Update") : _("Save"),
            style_class: "calendar-event-button",
            x_expand: true
        });

        saveBtn.connect("clicked", () => {
            const title = titleEntry.get_text().trim();
            if (!title) return;

            const isFullDay = allDayCheckbox.checked;
            const start = this._buildDateTime(date, startEntry.get_text());
            const end = this._buildDateTime(date, endEntry.get_text());

            this.applet.eventManager.addEvent({
                id: currentId,
                sourceUid: editingEvent ? editingEvent.sourceUid : undefined,
                summary: title,
                // Description intentionally disabled due to EDS limitations
                description: "",
                start: start,
                end: end,
                isFullDay: isFullDay,
                color: editingEvent ? editingEvent.color : "#3498db"
            });

            /* Reset Day View state */
            this.dayMode = "VIEW";
            this.editingEvent = null;
            this.render();
        });

        /* --------------------------------------------------------
         * FINAL ASSEMBLY
         * --------------------------------------------------------
         */

        box.add_actor(allDayCheckbox);
        box.add_actor(titleEntry);
        box.add_actor(timeBox);
        /* box.add_actor(descEntry); */
        buttonBox.add_actor(saveBtn);
        box.add_actor(buttonBox);

        /* Ensure correct initial state */
        updateVisibility();

        return box;
    }

