    /* ============================================================
     * DATE HELPERS
     * ============================================================
     *
     * The following helper methods are pure utility functions
     * used throughout CalendarView.
     *
     * They are intentionally kept INSIDE the class instead of
     * being moved to a shared utils module.
     *
     * WHY?
     * - They depend on this.LOCALE
     * - They are tightly coupled to calendar rendering logic
     * - Keeping them here improves readability for new developers
     *
     * TODO (Refactoring Option):
     * - These helpers could be extracted into a separate
     *   DateUtils module if CalendarView ever gets split
     *   into multiple files.
     */

    /**
     * Returns localized short weekday names.
     *
     * Example (de_DE):
     * ["Mo", "Di", "Mi", "Do", "Fr", "Sa", "So"]
     *
     * IMPORTANT:
     * - Uses Intl.DateTimeFormat for proper localization
     * - Avoids hardcoding weekday strings
     *
     * Implementation detail:
     * - We generate arbitrary dates (Jan 1–7, 2024)
     * - Only the weekday part is relevant
     */
    private getDayNames(): string[] {
        const formatter = new Intl.DateTimeFormat(this.LOCALE, {
            weekday: "short",
        });

        return [1, 2, 3, 4, 5, 6, 7].map(d =>
            formatter.format(new Date(2024, 0, d))
        );
    }

    /**
     * Calculates ISO-8601 week number for a given date.
     *
     * WHY THIS EXISTS:
     * - JavaScript does NOT provide a native week number API
     * - Cinnamon calendar optionally displays week numbers
     *
     * Implementation notes:
     * - Uses UTC to avoid timezone-related off-by-one errors
     * - Thursday-based week calculation per ISO standard
     *
     * Reference:
     * - ISO 8601 defines week 1 as the week containing Jan 4th
     */
    private getWeekNumber(date: Date): number {
        const d = new Date(
            Date.UTC(
                date.getFullYear(),
                date.getMonth(),
                date.getDate()
            )
        );

        // Move to Thursday of the current week
        d.setUTCDate(
            d.getUTCDate() + 4 - (d.getUTCDay() || 7)
        );

        const yearStart = new Date(
            Date.UTC(d.getUTCFullYear(), 0, 1)
        );

        return Math.ceil(
            (
                (d.getTime() - yearStart.getTime()) /
                86400000 +
                1
            ) / 7
        );
    }

    /* ============================================================
     * TIME / DATE HELPERS FOR DAY VIEW FORMS
     * ============================================================
     *
     * These helpers are used exclusively by:
     * - createTerminForm()
     * - Day View time handling
     *
     * They convert between:
     * - UI-friendly strings (HH:MM)
     * - JavaScript Date objects
     *
     * WHY THIS IS NECESSARY:
     * - St.Entry widgets only handle strings
     * - EventManager requires Date objects
     * - Keeping conversion logic centralized avoids bugs
     */

    /**
     * Returns current local time formatted as HH:MM.
     *
     * Used when creating a NEW event to pre-fill
     * the start time field.
     */
    private _getCurrentTime(): string {
        const now = new Date();
        return `${String(now.getHours()).padStart(2, "0")}:${String(
            now.getMinutes()
        ).padStart(2, "0")}`;
    }

    /**
     * Calculates a default end time (+1 hour)
     * based on a given start time string.
     *
     * Example:
     * startTime = "14:30" → endTime = "15:30"
     *
     * Used for:
     * - New events
     * - Improving UX by avoiding empty end fields
     */
    private _calculateDefaultEnd(startTime: string): string {
        const [h, m] = startTime.split(":").map(Number);
        const d = new Date();
        d.setHours(h + 1, m, 0, 0);

        return `${String(d.getHours()).padStart(2, "0")}:${String(
            d.getMinutes()
        ).padStart(2, "0")}`;
    }

    /**
     * Builds a Date object from:
     * - A base calendar date
     * - A time string (HH:MM)
     *
     * This is the final step before sending
     * data to EventManager / EDS.
     *
     * Example:
     * date = 2026-01-05
     * time = "09:15"
     * → Date(2026-01-05T09:15:00)
     */
    private _buildDateTime(date: Date, time: string): Date {
        const [h, m] = time.split(":").map(Number);
        const d = new Date(date);
        d.setHours(h, m, 0, 0);
        return d;
    }

}

/* ================================================================
 * HYBRID EXPORT STRATEGY (DEVELOPMENT vs PRODUCTION)
 * ================================================================
 *
 * This section is EXTREMELY IMPORTANT.
 *
 * DO NOT REMOVE unless you fully understand Cinnamon's
 * loading mechanisms.
 *
 * WHY THIS EXISTS:
 *
 * Cinnamon applets run in a hybrid environment:
 *
 * 1) DEVELOPMENT / BUILD TIME
 *    - TypeScript
 *    - Modular imports
 *    - Bundlers / transpilers
 *
 * 2) PRODUCTION / RUNTIME
 *    - GJS (GNOME JavaScript)
 *    - No real module loader
 *    - Global namespace access
 *
 * To support BOTH environments, we export the class in
 * two different ways.
 */

/* ---------------------------------------------------------------
 * CommonJS-style export (build / tooling environments)
 * ---------------------------------------------------------------
 *
 * This allows:
 * - Unit testing
 * - TypeScript compilation
 * - IDE tooling
 */

if (typeof exports !== "undefined") {
    exports.CalendarView = CalendarView;
}

/* ---------------------------------------------------------------
 * Global export (Cinnamon runtime)
 * ---------------------------------------------------------------
 *
 * Cinnamon loads applets by evaluating a single JS file.
 * There is NO module system at runtime.
 *
 * Therefore:
 * - Classes MUST be attached to the global object
 * - Other files access them via global.CalendarView
 *
 * The `(global as any)` cast:
 * - Is required to silence TypeScript
 * - Reflects the dynamic nature of GJS
 *
 * WARNING TO FUTURE DEVELOPERS:
 *
 * Removing this WILL:
 * - Work in development
 * - FAIL in production
 * - Break runtime imports silently
 */

(global as any).CalendarView = CalendarView;

